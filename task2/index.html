<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Заполнение резюме</title>

	<script src="https://unpkg.com/vue@next"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>



<!-- 2. Сделать форму заполнения резюме для поиска работы.

Пользователь заполняет текстовые поля с данными о себе. Ниже (или правее) на странице располагается шаблон резюме, в который введенные данные подставляются.
Список полей:
- профессия
- город
- ссылка на фото
- фио
- телефон
- email
- дата рождения
- образование
- желаемая зарплата
- ключевые навыки
- о себе
Резюме должно формироваться на лету с помощью вычисляемых свойств.

Здесь и далее для верстки рекомендуем использовать bootstrap.
За основу берите внешний вид резюме на hh.ru, но точное соответствие не требуется. -->


<!-- Добавить валидацию номера телефона средствами Vue. Телефон может состоять только из цифр и иметь длину от 6 до 10 символов.

Доработать блок “Образование”. Он должен состоять из селекта “Уровень” и доп. полей.
Варианты уровней образования:
- Среднее
- Среднее специальное
- Неоконченное высшее
- Высшее
Если выбран уровень образования “Среднее”, то никаких дополнительных полей не появляется.
Если выбран один из вариантов “Среднее специальное”, “Неоконченное высшее”, “Высшее”, то появляются доп. поля
- Учебное заведение
- Факультет
- Специализация
- Год окончания -->

<body>
	<div id="app">
		<div class="d-flex flex-row w-100">
			<div class="summary-form__wrapper container-fluid w-50 p-3">
				<form id="summaryForm" class="summary-form flex-column mx-auto rounded-3 overflow-hidden px-2" name="form">
					<h4 class="mx-auto text-center">Заполните данные о себе</h4>
					<div class="summary-form__body text-dark d-flex flex-column">
						<label for="summaryFormProfession">Профессия</label>
						<input type="text" v-model="summaryFormData.profession" id="summaryFormProfession" class="form-control" placeholder="Название профессии">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.profession, constraints().profession)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormCity">Город проживания</label>
						<input type="text" v-model="summaryFormData.city" id="summaryFormCity" class="form-control" placeholder="Название города">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.city, constraints().city)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormAvatarUrl">Ссылка на фото</label>
						<input type="text" v-model="summaryFormData.avatarUrl" id="summaryFormAvatarUrl" class="form-control" placeholder="http://example.site">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.avatarUrl, constraints().avatarUrl)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormLastName">Фамилия</label>
						<input type="text" v-model="summaryFormData.lastName" id="summaryFormLastName" class="form-control" placeholder="Иванов">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.lastName, constraints().lastName)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormFirstName">Имя</label>
						<input type="text" v-model="summaryFormData.firstName" id="summaryFormFirstName" class="form-control" placeholder="Иван">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.firstName, constraints().firstName)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormPatronymic">Отчество</label>
						<input type="text" v-model="summaryFormData.patronymic" id="summaryFormPatronymic" class="form-control" placeholder="Иванович">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.patronymic, constraints().patronymic)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormPhone">Телефон</label>
						<input type="text" v-model="summaryFormData.phone" id="summaryFormPhone" class="form-control" placeholder="9001002030">
						<!-- <div class="form-text">Сокращенный (6 цифр) или полный без кода страны (10 цифр)</div> -->

						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.phone, constraints().phone)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormEmail">Email</label>
						<input type="text" v-model="summaryFormData.email" id="summaryFormEmail" class="form-control" placeholder="example@some.site">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.email, constraints().email)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormBirthday">Дата рождения</label>
						<input type="date" v-model="summaryFormData.birthday" id="summaryFormBirthday">
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.birthday, constraints().birthday)">
								{{ message }}
							</li>
						</ul>

						<!-- TODO -->
						<label for="">Образование</label> 
						<select v-model="summaryFormData.education" name="education" id="summaryFormEducation" class="form-control">
							<option value="">Основное общее</option>
							<option value="">Среднее общее</option>
							<option value="">Начальное профессиональное</option>
							<option value="">Среднее профессиональное</option>
							<option value="">Бакалавр</option>
							<option value="">Специалист</option>
							<option value="">Магистр</option>
							<option value="">Аспирант</option>
						</select>
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.education, constraints().education)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormDesiredSalary">Желаемая зарплата</label>
						<input type="number" v-model="summaryFormData.desiredSalary" id="summaryFormDesiredSalary" class="form-control">

						<label for="summaryFormKeySkills">Ключевые навыки</label>
						<textarea v-model="summaryFormData.keySkills" id="summaryFormKeySkills" class="form-control" placeholder="Symfony, Vuejs, ..."></textarea>
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.keySkills, constraints().keySkills)">
								{{ message }}
							</li>
						</ul>

						<label for="summaryFormAbout">О себе</label>
						<textarea v-model="summaryFormData.about" type="text" id="summaryFormAbout" class="form-control" placeholder="Попытайтесь описать себя"></textarea>
						<ul class="invalid-feedback d-block">
							<li v-for="message in formatErrors(summaryFormData.about, constraints().about)">
								{{ message }}
							</li>
						</ul>
					</div>
        		</form>
			</div>
			<div class="container-fluid w-50 p-3">
				<h4 class="mx-auto text-center">Ваше резюме</h5>
				<img v-show="isValid(summaryFormData.url, constraints().url)" src="summaryFormData.url" alt="Аватар">
				<h3 v-if="isFullNameValid()">
					{{fullName}}
				</h3>

				<h3>О себе</h3>
				<p v-show="summaryFormData.birthday">
					Дата рождения: {{summaryFormData.birthday}}
				</p>
				<p v-show="isValid(summaryFormData.city, constraints().city)">
					г. {{summaryFormData.city}}
				</p>
				<p v-show="isValid(summaryFormData.about, constraints().about) && summaryFormData.about">
					{{summaryFormData.about}}
				</p>
				
				<h3>Профессиональные качества</h3>
				<p v-show="summaryFormData.education">
					Образование: {{summaryFormData.education}}
				</p>
				<p v-show="isValid(summaryFormData.profession, constraints().profession)">
					Профессия: {{summaryFormData.profession}}
				</p>
				<p v-show="summaryFormData.desiredSalary > 0">
					Желаемая заработная плата: {{summaryFormData.desiredSalary}} ₽
				</p>
				<p v-show="isValid(summaryFormData.keySkills, constraints().keySkills) && summaryFormData.keySkills">
					Ключевые навыки: {{summaryFormData.keySkills}}
				</p>

				<h3 v-show="isValid(summaryFormData.phone, constraints().phone) || isValid(summaryFormData.email, constraints().email)">
					Контакты
				</h3>
				<p v-show="isValid(summaryFormData.phone, constraints().phone)">
					Телефон: {{formattedPhone}}
				</p>
				<p v-show="isValid(summaryFormData.email, constraints().email) && summaryFormData.email">
					Email: {{summaryFormData.email}}
				</p>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
	<script>
		const vm = Vue.createApp({
			data() {
				return {
					summaryFormData: {
						profession: '',
						city: '',
						avatarUrl: '',
						lastName: '',
						firstName: '',
						patronymic: '',
						phone: '',
						email: '',
						birthday: '',
						education: '',
						desiredSalary: '',
						keySkills: '',
						about: '',
					},
					regexes: {
						isAlpha: new RegExp('^[A-ЯЁ][а-яё\-]{1,32}$', 'u'),
						isAlphaMultiWords: new RegExp('^[A-ЯЁ][а-яё]{1,32}( ([а-яё]{1,32}))*$', 'u'),
						isDigit: new RegExp('^[0-9]+$'),
						city: new RegExp('^[А-ЯЁ][а-яё]{1,20}[\- ]?[А-ЯЁа-яё]{1,20}$'),
						email: new RegExp('^[\dA-Za-z][.-_\dA-Za-z]+[\dA-Za-z]?@([-\dA-Za-z]+\.){1,2}[-A-Za-z]{2,7}$'),
						url: new RegExp('^https?\:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$')
					},
					regexErrorMessages: {
						isAlpha: 'Только слово на русском с заглавной буквы',
						isAlphaMultiWords: 'Только слова на русском. Первое - с заглавной буквы',
						isDigit: 'Только цифры',
						city: 'Некорректное название города',
						email: 'Некорректный email',
						url: 'Некорректная ссылка'
					}
				};
			},
			watch: {
			},
			computed: {
				fullName() {
					let fullName = this.summaryFormData.lastName + ' ' + 
						this.summaryFormData.firstName;
					if (this.summaryFormData.patronymic) {
						fullName += ' ' + this.summaryFormData.patronymic;
					}
					return fullName;
				},
				formattedPhone: {
					get() {
						if (this.summaryFormData.phone.length === 10) {
							return '+7' + this.summaryFormData.phone;
						}
						return this.summaryFormData.phone;
					}
				}
			},
			methods: {
				isValid(value, constraints) {
					if (!constraints || !value && !constraints.required) {
					    return true;
					} else if (constraints.required && !value) {
						return false;
					} else if (constraints.minLength && value.length < constraints.minLength) {
					    return false;
					} else if (constraints.maxLength && value.length > constraints.maxLength) {
					    return false;
					} else if (constraints.regex && !constraints.regex.test(value)) {
					    return false;
					}
					return true;
				},
				isFullNameValid() {
					return this.isValid(this.summaryFormData.firstName, this.constraints().firstName) &&
						this.isValid(this.summaryFormData.lastName, this.constraints().lastName) &&
						this.isValid(this.summaryFormData.patronymic, this.constraints().patronymic);
				},

				formatErrors(value, constraints) {
					let errors = [];

					if (!constraints || !value && !constraints.required) {
					    return errors;
					}
					if (constraints.required && !value) {
						errors.push('Обязательное поле');
					}

					let lenghtMessage = 'Длина - ';
					if (constraints.minLength && value.length < constraints.minLength) {
					    lenghtMessage += ' от ' + constraints.minLength;
					}
					if (constraints.maxLength && value.length > constraints.maxLength) {
						lenghtMessage += ' до ' +  + constraints.maxLength;
					}
					if (lenghtMessage.length > 8) {
						lenghtMessage += ' символов'
						errors.push(lenghtMessage);
					}

					if (constraints.regex && constraints.regexErrorMessage && !constraints.regex.test(value)) {
					    errors.push(constraints.regexErrorMessage);
					}

					return errors;
				},
				
				constraints() {
					return {
						profession: {
							required: true,
							maxLength: 200,
							regex: this.regexes.isAlphaMultiWords,
							regexErrorMessage: this.regexErrorMessages.isAlphaMultiWords
						},
						city: {
							required: true,
							regex: this.regexes.city,
							regexErrorMessage: this.regexErrorMessages.city
						},
						avatarUrl: {
							required: false,
							regex: this.regexes.url,
							regexErrorMessage: this.regexErrorMessages.url
						},
						lastName: {
							required: true,
							minLength: 2,
							maxLength: 64,
							regex: this.regexes.isAlpha,
							regexErrorMessage: this.regexErrorMessages.isAlpha
						},
						firstName: {
							required: true,
							minLength: 2,
							maxLength: 64,
							regex: this.regexes.isAlpha,
							regexErrorMessage: this.regexErrorMessages.isAlpha
						},
						patronymic: {
							required: false,
							minLength: 4,
							maxLength: 64,
							regex: this.regexes.isAlpha,
							regexErrorMessage: this.regexErrorMessages.isAlpha
						},
						phone: {
							required: true,
							minLength: 6,
							maxLength: 10,
							regex: this.regexes.isDigit,
							regexErrorMessage: this.regexErrorMessages.isDigit
						},
						email: {
							required: false,
							minLength: 5,
							maxLength: 128,
							regex: this.regexes.email,
							regexErrorMessage: this.regexErrorMessages.email
						},
						birthday: {
							required: true,
						},
						desiredSalary: {
							required: false,
						},
						keySkills: {
							required: false,
							maxLength: 2048,
						},
						about: {
							required: false,
							minLength: 32,
							maxLength: 2048,
						},
					};
				}
			},
		}).mount('#app')
	</script>

	<style>
		p+p {
			margin-bottom: 5px;
		}

		.summary-form__body .input-group-text {
			background: #8E1030;
			border: none;
			color: white;
		}

		.summary-form {
			max-width: 600px;
		}

		.summary-form__header {
			background: #003A6C;
		}

		.summary-form__header__swap-btn {
			padding: 0;
			border: none;
			font-size: 1.5rem;
			background: #002D54;
		}

		.summary-form__body {
			min-height: 30px;
		}

		.invalid-feedback {
			font-size: 0.8rem;
		}
	</style>
</body>
</html>
